---
title: "Tree growth, mortality, and climatic stress in west-coast states, USA"
author:
  - name: "Jeremiah D. Groom"
    affiliations:
      - name: "Groom Analytics LLC"
        address: "1975 SE Crystal Lake Dr., Unit 173"
        city: "Corvallis"
        state: "OR"
        postal-code: "97333"
    orcid: "0000-0002-0110-1036"
    email: "jeremy@groomanalytics.com"
  - name: "Bryce Frank"
    affiliations:
      - name: "USDA Forest Service"
        department: "Pacific Northwest Field Station"
        address: "3625 93rd Ave SW"
        city: "Olympia"
        state: "WA"
        postal-code: "98512"
abstract: |
  Your abstract goes here. This should be a concise summary of your research question, methods, key findings, and implications. Keep it within journal word limits (typically 150-300 words).
keywords: [keyword1, keyword2, keyword3, keyword4]
date: today
format:
  docx:
    reference-doc: template_use2.docx 
    prefer-html: false
    toc: false
    number-sections: true
    highlight-style: github
execute:
  echo: false
  warning: false
  message: false
  cache: true
---

```{r setup, include = FALSE}


# Set global chunk options
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center",
  fig.width = 6,
  fig.height = 4,
  dpi = 300
)
```

```{r libraries}

library(kableExtra)   # Enhanced table formatting
library(scales)       # Scale functions for visualization
library(flextable)    # Professional tables for Word output
#library(officer)


```

```{r constants}

source("Global.R")

# Define any custom functions
format_p_value <- function(p) {
  case_when(
    p < 0.001 ~ "< 0.001",
    p < 0.01 ~ sprintf("= %.3f", p),
    TRUE ~ sprintf("= %.2f", p)
  )
}


library(flextable)
set_flextable_defaults(
  font.family = "Times",
  font.size = 11,
  theme_fun = "theme_vanilla"
)

```

```{r load-data}

# Species scientific names
spp.names.use <- spp.names %>% dplyr::select(SPCD, GENUS, SPECIES) %>%
  mutate(SpeciesCode = paste0("X", SPCD), 
         SciName = paste(GENUS, SPECIES)) %>%
  dplyr::select(SpeciesCode, SciName)

# Growth data for species overall and states
grow.state <- read_csv(paste0(RESULTS1.LOC, "Growth_figs_", CLIM.VAR.USE, "/State_Growth_", CLIM.VAR.USE, ".csv"))
grow.all <- read_csv(paste0(RESULTS1.LOC, "Growth_figs_", CLIM.VAR.USE, "/All_Growth_", CLIM.VAR.USE, ".csv"))

#class(grow.state)
#class(grow.all)
```


```{r table-creation}
# State growth
s.g.1 <- dplyr::left_join(spp.names.use, grow.state, by = c("SpeciesCode" = "Species")) %>%
  dplyr::mutate_if(is.numeric, round, 2) %>% 
  dplyr::mutate(results = case_when(is.na(Median) ~ "", 
                              !is.na(Median) ~ paste0(Means, " (", LCI.95, ",", UCI.95, "; ", n.plts, ")"))) %>%
  dplyr::select(SciName, State, results) %>%
  tidyr::pivot_wider(names_from = State, values_from = results) %>%
  dplyr::select(-`NA`) %>%
  dplyr::rename("California" = "CA", "Washington" = "WA", "Oregon" = "OR")
  
s.g.2 <- dplyr::left_join(spp.names.use, grow.all, by = c("SpeciesCode" = "Species")) %>%
  dplyr::mutate_if(is.numeric, round, 2) %>% 
  dplyr::mutate(results = case_when(is.na(Median) ~ "", 
                              !is.na(Median) ~ paste0(Means, " (", LCI.95, ",", UCI.95, "; ", n.plts, ")"))) %>%
  dplyr::select(SciName, results) %>%
 dplyr::rename("All" = "results")


s.g.3 <- dplyr::left_join(s.g.1, s.g.2, by = "SciName") %>% 
  tidyr::replace_na(list(California = "", Washington = "", Oregon = "")) %>%
  dplyr::filter(All != "")
  



growth.ft <- flextable(s.g.3) %>%
  fontsize(size = 9, part = "body") %>%
  line_spacing(i = NULL, j = NULL, space = 0.2, part = "body") %>% # Control space between lines. 
  theme_zebra(
    odd_header = "#FFFFFF",   # White background for header
    even_header = "#FFFFFF",  # White background for header
    odd_body = "#F9F9F9",     # Light gray for odd rows
    even_body = "#FFFFFF"     # White for even rows
  ) %>%
  autofit() %>%
  set_table_properties(layout = "autofit", width = 1)

# State mortality
#s.m.1 <- 



```

\newpage
<!---BLOCK_LANDSCAPE_START--->
```{r tbl-growth}
#| tbl-cap: "Growth estimates by state and overall for analysis species.  Mean estimates with confidence intervals and plot number are provided.  Estimates are not made for states with fewer than 10 plots."
growth.ft  
```

<!---BLOCK_LANDSCAPE_STOP--->


# Introduction

Your introduction should provide background context, review relevant literature, identify gaps in current knowledge, and clearly state your research objectives and hypotheses.

## Background and Rationale

Provide the scientific background and rationale for your study. Cite relevant literature using the format [@author2023] for in-text citations.

## Study Objectives

Clearly state your primary and secondary objectives or research questions.

# Methods

## Study Design

Describe your study design, including the overall approach and methodology.

## Participants

Describe your study population, inclusion/exclusion criteria, and recruitment methods.

## Data Collection

Detail your data collection procedures, instruments used, and any quality control measures.

## Statistical Analysis

Describe your statistical analysis plan, including software used, significance levels, and specific tests performed.

# Results



Describe your main findings here, referencing 



```{r statistical-tests}
```

The analysis revealed a significant difference between groups , with a mean difference of  units.

# Discussion

## Main Findings

Summarize your key findings and their interpretation in the context of existing literature.

## Limitations

Acknowledge study limitations and their potential impact on your findings.

## Implications and Future Directions

Discuss the implications of your findings for theory, practice, and future research.

# Conclusion

Provide a concise summary of your main findings and their significance.

# Acknowledgments

Acknowledge funding sources, collaborators, and others who contributed to the work.

# References

::: {#refs}
:::

# Supplementary Material

```{r supplementary-table}
```

```{r supplementary-figure}

```
